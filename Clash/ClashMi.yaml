 # ClashMi
 # author : William
 # ==================== 用戶配置區
 
allow-lan: true
unified-delay: true
tcp-concurrent: true
find-process-mode: strict
global-client-fingerprint: chrome
profile:
    store-selected: true
    store-fake-ip: true
sniffer:
    enable: true
    sniff:
        HTTP:
            ports: [80, 8080-8880]
            override-destination: true
        TLS:
            ports: [443, 8443]
        QUIC:
            ports: [443, 8443]
    skip-domain:
        - "Mijia Cloud"
        - dlg.io.mi.com
        - "+.push.apple.com"
tun:
    enable: true
    stack: system
    device: mihomo
    dns-hijack:
        - any:53
        - tcp://any:53
    auto-route: true
    auto-detect-interface: true
    strict-route: true
    endpoint-independent-nat: true
dns:
    enable: true
    listen: 0.0.0.0:53
    ipv6: false
    prefer-h3: true
    respect-rules: true
    enhanced-mode: fake-ip
    use-hosts: true
    use-system-hosts: true
    default-nameserver:
        - tls://1.12.12.12
        - 223.5.5.5
        - 114.114.114.114
    nameserver:
        - https://dns.cloudflare.com/dns-query
        - https://dns.rabbitdns.org/dns-query
        - https://dns.google/dns-query
    proxy-server-nameserver:
        - https://223.5.5.5/dns-query
        - https://dns.pub/dns-query
    nameserver-policy:
        "geosite:cn,apple-cn,category-games@cn,private":
            - https://223.5.5.5/dns-query
            - https://dns.pub/dns-query
    fake-ip-range: 198.18.0.1/16
    fake-ip-filter:
      - '*.lan'
      - '*.localdomain'
      - '*.example'
      - '*.invalid'
      - '*.localhost'
      - '*.test'
      - '*.local'
      - '*.home.arpa'
      - '*.direct'
      - 'time.*.com'
      - 'time.*.gov'
      - 'time.*.edu.cn'
      - 'time.*.apple.com'
      - 'time-ios.apple.com'
      - 'time1.*.com'
      - 'time2.*.com'
      - 'time3.*.com'
      - 'time4.*.com'
      - 'time5.*.com'
      - 'time6.*.com'
      - 'time7.*.com'
      - 'ntp.*.com'
      - 'ntp1.*.com'
      - 'ntp2.*.com'
      - 'ntp3.*.com'
      - 'ntp4.*.com'
      - 'ntp5.*.com'
      - 'ntp6.*.com'
      - 'ntp7.*.com'
      - '*.time.edu.cn'
      - '*.ntp.org.cn'
      - '+.pool.ntp.org'
      - 'time1.cloud.tencent.com'
      - 'music.163.com'
      - '*.music.163.com'
      - '*.126.net'
      - 'musicapi.taihe.com'
      - 'music.taihe.com'
      - 'songsearch.kugou.com'
      - 'trackercdn.kugou.com'
      - '*.kuwo.cn'
      - 'api-jooxtt.sanook.com'
      - 'api.joox.com'
      - 'joox.com'
      - 'y.qq.com'
      - '*.y.qq.com'
      - 'streamoc.music.tc.qq.com'
      - 'mobileoc.music.tc.qq.com'
      - 'isure.stream.qqmusic.qq.com'
      - 'dl.stream.qqmusic.qq.com'
      - 'aqqmusic.tc.qq.com'
      - 'amobile.music.tc.qq.com'
      - '*.xiami.com'
      - '*.music.migu.cn'
      - 'music.migu.cn'
      - '+.msftconnecttest.com'
      - '+.msftncsi.com'
      - 'localhost.ptlogin2.qq.com'
      - 'localhost.sec.qq.com'
      - 'localhost.*.weixin.qq.com'
      - '+.steamcontent.com'
      - '+.srv.nintendo.net'
      - '*.n.n.srv.nintendo.net'
      - '+.cdn.nintendo.net'
      - '+.stun.playstation.net'
      - 'xbox.*.*.microsoft.com'
      - '*.*.xboxlive.com'
      - 'xbox.*.microsoft.com'
      - 'xnotify.xboxlive.com'
      - '+.battle.net'
      - '+.battlenet.com.cn'
      - '+.wotgame.cn'
      - '+.wggames.cn'
      - '+.wowsgame.cn'
      - '+.wargaming.net'
      - 'proxy.golang.org'
      - 'stun.*.*'
      - 'stun.*.*.*'
      - '+.stun.*.*'
      - '+.stun.*.*.*'
      - '+.stun.*.*.*.*'
      - '+.stun.*.*.*.*.*'
      - 'heartbeat.belkin.com'
      - '*.linksys.com'
      - '*.linksyssmartwifi.com'
      - '*.router.asus.com'
      - 'mesu.apple.com'
      - 'swscan.apple.com'
      - 'swquery.apple.com'
      - 'swdownload.apple.com'
      - 'swcdn.apple.com'
      - 'swdist.apple.com'
      - 'lens.l.google.com'
      - 'stun.l.google.com'
      - 'na.b.g-tun.com'
      - '+.nflxvideo.net'
      - '*.square-enix.com'
      - '*.finalfantasyxiv.com'
      - '*.ffxiv.com'
      - '*.ff14.sdo.com'
      - 'ff.dorado.sdo.com'
      - '*.mcdn.bilivideo.cn'
      - '+.media.dssott.com'
      - 'shark007.net'
      - 'Mijia Cloud'
      - '+.market.xiaomi.com'
      - '+.cmbchina.com'
      - '+.cmbimg.com'
      - 'adguardteam.github.io'
      - 'adrules.top'
      - 'anti-ad.net'
      - 'local.adguard.org'
      - 'static.adtidy.org'
      - '+.sandai.net'
      - '+.n0808.com'
      - '+.3gppnetwork.org'
      - '+.uu.163.com'
      - 'ps.res.netease.com'
      - '+.oray.com'
      - '+.orayimg.com'
      - '+.gcloudcs.com'
      - '+.gcloudsdk.com'
geodata-mode: true
geox-url:
    geoip: "https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geoip.dat"
    geosite: "https://github.com/Loyalsoldier/v2ray-rules-dat/releases/latest/download/geosite.dat"

proxy-groups:

  - name: Proxy
    type: select
    proxies: [HK,TW,JP,SG,US,NL,Download,All,direct]

  - name: Google
    type: select
    proxies: [Proxy,HK,TW,JP,SG,US,All,direct]

  - name: Telegram
    type: select
    proxies: [Proxy,HK,TW,JP,SG,US,All,direct]

  - name: Twitter
    type: select
    proxies: [Proxy,HK,TW,JP,SG,US,All,direct]

  - name: YouTube
    type: select
    proxies: [Proxy,HK,TW,JP,SG,US,All,direct]

  - name: Github
    type: select
    proxies:  [Proxy,HK,TW,JP,SG,US,All,direct]

  - name: OpenAI
    type: select
    proxies:  [Proxy,TW,JP,SG,US]

  - name: Microsoft
    type: select
    proxies:  [Proxy,HK,TW,JP,SG,US,All,direct]

  - name: CN
    type: select
    proxies:  [direct,Proxy,HK,TW,JP,SG,US,All]

  - name: World
    type: select
    proxies:  [Proxy,HK,TW,JP,SG,US,All,direct]


  #分隔,下面是地區分組

  - name: US
    type: url-test
    use:
      - ProviderAirPort
    filter: "(?i)美|us|unitedstates|united states|c7s1|c7s2|c7s3"
    url: 'http://www.apple.com/library/test/success.html'
    interval: 300
    tolerance: 50
    #lazy: true    
    
  - name: JP
    type: url-test
    use:
      - ProviderAirPort
    filter: "(?i)日|jp|japan|c7s4"
    url: 'http://www.apple.com/library/test/success.html'
    interval: 300
    tolerance: 50
    #lazy: true    

  - name: SG
    type: url-test
    use:
      - ProviderAirPort
    filter: "(?i)新|sg|singapore"
    url: 'http://www.apple.com/library/test/success.html'
    interval: 300
    tolerance: 50
    #lazy: true

  - name: NL
    type: url-test
    use:
      - ProviderAirPort
    filter: "(?i)nl|荷|c7s5"
    url: 'http://www.apple.com/library/test/success.html'
    interval: 300
    tolerance: 50
    #lazy: true
    
  - name: HK
    type: url-test
    use:
      - ProviderAirPort
    filter: "(?i)港|hk|hongkong|hong kong"
    url: 'http://www.apple.com/library/test/success.html'
    interval: 300
    tolerance: 50
    #lazy: true
          
  - name: TW
    type: url-test
    use:
      - ProviderAirPort
    filter: "(?i)台|tw|taiwan"
    url: 'http://www.apple.com/library/test/success.html'
    interval: 300
    tolerance: 50
    #lazy: true    


  - name: Download
    type: url-test
    use:
      - ProviderAirPort
    filter: "(?i)(c7s801)"
    url: 'http://www.apple.com/library/test/success.html'
    interval: 300
    tolerance: 50
    #lazy: true

  - name: All
    type: select
    include-all: true

rules:
  - RULE-SET,private_ip,direct,no-resolve
  - RULE-SET,github_domain,Github
  - RULE-SET,twitter_domain,Twitter
  - RULE-SET,youtube_domain,YouTube
  - RULE-SET,google_domain,Google
  - RULE-SET,telegram_domain,Telegram
  - RULE-SET,cn_domain,CN
  - RULE-SET,openai_domain,OpenAI
  - RULE-SET,microsoft_domain,Microsoft
  - RULE-SET,geolocation-!cn,World
  - RULE-SET,gfw_domain,World  

  - RULE-SET,google_ip,Google
  - RULE-SET,telegram_ip,Telegram
  - RULE-SET,twitter_ip,Twitter
  - RULE-SET,cn_ip,CN
  - MATCH,World

  - GEOIP,google,Google
  - GEOIP,telegram,Telegram
  - GEOIP,twitter,Twitter
  - GEOIP,CN,CN

rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: text}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: text}
rule-providers:
  private_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.list"
  cn_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.list"
  github_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/github.list"
  twitter_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/twitter.list"
  youtube_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.list"
  google_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.list"
  telegram_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.list"
  openai_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/openai.list"    
  microsoft_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.list"      
  geolocation-!cn:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.list"
  gfw_domain:
    <<: *domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/gfw.list"         

  private_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/private.list"
  cn_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.list"
  google_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/google.list"
  netflix_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/netflix.list"
  twitter_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/twitter.list"
  telegram_ip:
    <<: *ip
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/telegram.list"
